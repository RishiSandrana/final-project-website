---
title: "Home"
---

```{r}
#| echo: false
#| message: false
#| warning: false
library(tidyverse)
library(plotly)
library(ggthemes)
```

```{r}
#| echo: false
#| message: false
iqData <- read_csv("data/IQRankings.csv")
rankingData <- read_csv("data/EducationRankings.csv")
scoresData <- read_csv("data/TestScoreData.csv")

rankingData <- rankingData |>
  select(country, rank2021, pop2023)

iqData <- iqData |>
  select(country, iq)

scoresData <- scoresData |>
  rename(country = Entity) |>
  rename_at(7, ~ "score") |>
  drop_na() |>
  select(country, score)

mergedData <- iqData |>
  inner_join(scoresData, by = "country") |>
  inner_join(rankingData, by = "country")
```

```{r}
#| echo: false
#| message: false
#| warning: false

model1 <- lm(rank2021 ~ score, data = mergedData)
intercept <- coef(model1)[1]
slope <- coef(model1)[2]
equation <- paste("Rank =", round(intercept, 2), "+", round(slope, 2), "* Score")

plot1 <- mergedData |>
  ggplot(aes(x = score, y = rank2021, size = pop2023, color = country)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = "lm", color = "orange", se = FALSE) +
  guides(color = "none", size = "none") +
  labs(
    title = "Test Scores and Education Ranking",
    x = "Average Test Scores in Math and Science",
    y = "Education Ranking",
    caption = "Our World in Data (2016)\nWorld Population Review (2023)"
  ) +
  theme_clean() +
  annotate(
    "text", 
    x = max(mergedData$score), 
    y = max(mergedData$rank2021),
    label = equation, 
    hjust = 1
  )

plot1
# ggplotly(plot1)
```